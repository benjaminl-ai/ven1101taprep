<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VEN1101 Prep Task Helper (Fashion)</title>
    <style>
        :root { 
            --yt-red: #ff0000; --yt-black: #0f0f0f; --yt-grey: #606060; --yt-white: #ffffff;
            --primary: #ef233c; --dark: #2b2d42; --glass: rgba(255,255,255,0.6); 
            --shop-bg: #f8f1e5; --success: #38b000; 
        }
        body { font-family: "Roboto", Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 0; }
        
        header { background: var(--yt-white); padding: 12px; border-bottom: 1px solid #e5e5e5; text-align: center; position: sticky; top: 0; z-index: 1000; }
        .logo { color: var(--yt-red); font-weight: bold; font-size: 1.2rem; }
        
        .nav-tabs { display: flex; background: white; border-bottom: 1px solid #ddd; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; font-weight: bold; cursor: pointer; color: var(--yt-grey); border-bottom: 3px solid transparent; }
        .tab-btn.active { color: var(--yt-red); border-bottom-color: var(--yt-red); }

        .container { padding: 15px; max-width: 500px; margin: 0 auto; display: none; }
        .container.active { display: block; }

        /* Wiring a Plug Styles (Reused for Fashion) */
        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border: 1px solid #eee; }
        .fa-img { width: 100%; height: 200px; background-size: contain; background-repeat: no-repeat; background-position: center; background-color: #fff; border-radius: 8px; margin-bottom: 12px; border: 1px solid #eee; }
        textarea { width: 100%; height: 38px; border: 1px solid #ccc; border-radius: 8px; padding: 8px; box-sizing: border-box; font-size: 0.95rem; margin-bottom: 10px; outline: none; resize: none; overflow: hidden; }
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn { padding: 10px; border: none; border-radius: 20px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 5px; font-size: 0.85rem; }
        .btn-listen { background: #f2f2f2; color: #333; }
        .btn-record { background: var(--yt-black); color: white; transition: background 0.3s; }
        .recording { background: var(--yt-red) !important; animation: pulse 1s infinite; }

        /* Troubleshooting Styles */
        #troubleshooting { background: var(--shop-bg); min-height: 95vh; text-align: center; }
        .shop-banner { background: #d90429; color: white; padding: 8px; font-weight: bold; letter-spacing: 2px; font-size: 0.9rem; }
        
        .instruction-header { 
            background: var(--dark); color: #edf2f4; width: 100%; padding: 10px 0; 
            display: flex; justify-content: center; gap: 20px; font-size: 0.8rem;
        }
        .instruction-header div { display: flex; flex-direction: column; text-align: center; }

        .gacha-machine { width: 200px; height: 260px; display: flex; flex-direction: column; align-items: center; position: relative; margin: 15px auto; }
        .machine-top { 
            width: 190px; height: 125px; background: var(--glass); border: 6px solid var(--dark); 
            border-radius: 60px 60px 10px 10px; display: grid; grid-template-columns: repeat(4, 1fr); 
            grid-template-rows: repeat(3, 1fr); padding: 15px 10px 5px 10px; gap: 5px; box-sizing: border-box; justify-items: center;
        }
        .machine-body { width: 190px; height: 115px; background: var(--primary); border: 6px solid var(--dark); border-top: none; border-radius: 0 0 20px 20px; position: relative; z-index: 1; }
        .knob { width: 50px; height: 50px; background: #fff; border: 5px solid var(--dark); border-radius: 50%; margin: 10px auto; position: relative; cursor: pointer; transition: transform 0.4s; }
        .knob::after { content: ''; position: absolute; width: 30px; height: 8px; background: var(--dark); top: 16px; left: 5px; border-radius: 4px; }
        .knob.spin { transform: rotate(180deg); }
        .exit-port { width: 65px; height: 38px; background: var(--dark); border-radius: 8px 8px 0 0; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); }
        
        .capsule { width: 26px; height: 26px; border-radius: 50%; border: 1.5px solid var(--dark); }
        .out-capsule { width: 38px; height: 38px; border-radius: 50%; border: 3px solid var(--dark); position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); display: none; z-index: 10; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
        
        #recordBtnGacha { background: var(--success); color: white; border: none; padding: 14px 30px; border-radius: 35px; font-size: 1rem; cursor: pointer; display: none; margin: 10px auto; font-weight: bold; box-shadow: 0 4px 0 #247a00; }

        #modalOverlay { 
            display: none; position: fixed; top:0; left:0; width:100%; height:100%; 
            background: rgba(0,0,0,0.85); z-index: 2000; 
            align-items: center; justify-content: center;
        }
        .modal { 
            background: white; padding: 25px; border-radius: 20px; text-align: center; 
            width: 85%; max-width: 320px; box-sizing: border-box;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<header>
    <div class="logo">VEN1101 Prep Task Helper (Fashion)</div>
</header>

<div class="nav-tabs">
    <button class="tab-btn active" onclick="switchTab(0)">Using a Shredder PRO1</button>
    <button class="tab-btn" onclick="switchTab(1)">Troubleshooting</button>
</div>

<div id="wiring" class="container active">
    <div class="card">
        <div class="fa-img" style="background-image: url('fa1.jpg');"></div>
        <textarea id="f1" placeholder="Write the step here"></textarea>
        <div class="btn-row">
            <button class="btn btn-listen" onclick="speak('f1')">üîä Listen</button>
            <button class="btn btn-record" id="rf1" onclick="handleRecord('f1', 'rf1')">üé§ Record</button>
        </div>
    </div>

    <div class="card">
        <div class="fa-img" style="background-image: url('fa2.jpg');"></div>
        <textarea id="f2" placeholder="Write the step here"></textarea>
        <div class="btn-row">
            <button class="btn btn-listen" onclick="speak('f2')">üîä Listen</button>
            <button class="btn btn-record" id="rf2" onclick="handleRecord('f2', 'rf2')">üé§ Record</button>
        </div>
    </div>

    <div class="card">
        <div class="fa-img" style="background-image: url('fa3.jpg');"></div>
        <textarea id="f3" placeholder="Write the step here"></textarea>
        <div class="btn-row">
            <button class="btn btn-listen" onclick="speak('f3')">üîä Listen</button>
            <button class="btn btn-record" id="rf3" onclick="handleRecord('f3', 'rf3')">üé§ Record</button>
        </div>
    </div>

    <div class="card">
        <div class="fa-img" style="background-image: url('fa4.jpg');"></div>
        <textarea id="f4" placeholder="Write the step here"></textarea>
        <div class="btn-row">
            <button class="btn btn-listen" onclick="speak('f4')">üîä Listen</button>
            <button class="btn btn-record" id="rf4" onclick="handleRecord('f4', 'rf4')">üé§ Record</button>
        </div>
    </div>
</div>

<div id="troubleshooting" class="container">
    <div class="shop-banner">„Ç¨„Ç∑„É£„Éù„É≥ GACHAPON TOKYO</div>
    
    <div class="instruction-header">
        <div><span>1. Twist</span><span>Êâ≠ÂãïÊóãÈàï</span></div>
        <div><span>2. Listen</span><span>ËÅΩÂèñÂïèÈ°å</span></div>
        <div><span>3. Speak</span><span>ÈåÑÈü≥ÂõûÁ≠î</span></div>
    </div>

    <div style="background:white; margin: 10px auto; width: 95%; padding: 12px; border-radius: 8px; text-align: left; font-size: 0.85rem; border: 2px solid var(--dark);">
        <h3 style="margin: 0 0 5px 0; text-align: center;">Troubleshooting</h3>
        <ul id="studyList" style="padding-left: 20px; margin: 5px 0; line-height: 1.4;"></ul>
    </div>

    <div class="gacha-machine">
        <div class="machine-top" id="capsuleContainer"></div>
        <div class="machine-body">
            <div class="knob" id="knob"></div>
            <div class="exit-port"></div>
        </div>
        <div id="outCapsule" class="out-capsule"></div>
    </div>

    <button id="recordBtnGacha" onclick="handleGachaRecord()">üé§ Answer / ÈåÑÈü≥ÂõûÁ≠î</button>
</div>

<div id="modalOverlay">
    <div class="modal">
        <h2 id="mT">Perfect!</h2>
        <p id="mM"></p>
        <button onclick="document.getElementById('modalOverlay').style.display='none'" style="padding:10px 40px; border-radius:20px; border:none; background:var(--dark); color:white; font-weight:bold; cursor:pointer;">Close</button>
    </div>
</div>

<script>
    let currentRec = null;
    let activeId = "";

    function switchTab(idx) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.container')[idx].classList.add('active');
        document.querySelectorAll('.tab-btn')[idx].classList.add('active');
        if (currentRec) stopRec();
    }

    function speak(textOrId) {
        window.speechSynthesis.cancel();
        const input = document.getElementById(textOrId);
        const text = input ? input.value : textOrId;
        if(!text) return;
        const m = new SpeechSynthesisUtterance(text);
        m.lang = 'en-US'; m.rate = 0.85;
        window.speechSynthesis.speak(m);
    }

    // Task Record Logic
    function handleRecord(id, btnId) {
        const btn = document.getElementById(btnId);
        if (btn.classList.contains('recording')) { stopRec(); return; }
        if (currentRec) stopRec();
        activeId = id;
        startRec(btnId);
    }

    function startRec(btnId) {
        const btn = document.getElementById(btnId);
        const Rec = window.webkitSpeechRecognition || window.SpeechRecognition;
        if (!Rec) return alert("Browser not supported.");
        currentRec = new Rec();
        currentRec.lang = 'en-US';
        currentRec.continuous = true;
        btn.classList.add('recording');
        btn.innerHTML = "üõë Finish / ÂÆåÊàê";
        currentRec.onresult = (e) => { validate(e.results[e.results.length-1][0].transcript); };
        currentRec.onend = () => stopRec();
        currentRec.start();
    }

    // Troubleshooting Record Logic
    function handleGachaRecord() {
        const btn = document.getElementById('recordBtnGacha');
        if (btn.classList.contains('recording')) {
            stopRec();
            return;
        }
        
        const Rec = window.webkitSpeechRecognition || window.SpeechRecognition;
        if (!Rec) return alert("Not supported");
        
        currentRec = new Rec();
        currentRec.lang = 'en-US';
        currentRec.continuous = true;
        btn.innerText = "üõë Finish / ÂÆåÊàê";
        btn.classList.add('recording');
        
        currentRec.onresult = (e) => {
            const heard = e.results[e.results.length-1][0].transcript.toLowerCase();
            const isCorrect = heard.includes(currentA.toLowerCase());
            document.getElementById('mT').innerText = isCorrect ? "üåü Success!" : "‚ùå Incorrect";
            document.getElementById('mM').innerHTML = isCorrect ? "Excellent answer!" : `I heard: "${heard}"<br>Expected keyword: ${currentA}`;
            document.getElementById('modalOverlay').style.display = 'flex';
            stopRec();
        };
        currentRec.onend = () => stopRec();
        currentRec.start();
    }

    function stopRec() {
        if (currentRec) { currentRec.stop(); currentRec = null; }
        document.querySelectorAll('.btn-record, #recordBtnGacha').forEach(b => {
            b.classList.remove('recording');
            if(b.id === 'recordBtnGacha') b.innerText = "üé§ Answer / ÈåÑÈü≥ÂõûÁ≠î";
            else b.innerHTML = "üé§ Record";
        });
    }

    function validate(heard) {
        const target = document.getElementById(activeId).value.toLowerCase().replace(/[^\w\s]/gi, '');
        const words = target.split(" ").filter(w => w.length > 3);
        let matches = 0;
        words.forEach(w => { if(heard.toLowerCase().includes(w)) matches++; });
        const isGood = words.length === 0 || (matches / words.length) >= 0.5;
        
        document.getElementById('mT').innerText = isGood ? "üåü Excellent!" : "‚ö†Ô∏è Try Again";
        document.getElementById('mM').innerHTML = isGood ? `Perfect! <br><br><span style="color:green">"Heard: ${heard}"</span>` : `Try again! <br><br><span style="color:red">"Heard: ${heard}"</span>`;
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    // Gacha Logic
    const QA = [
        { q: "the machine overheats", a: "let it cool down" },
        { q: "the machine stops working", a: "check the power supply" },
        { q: "there is jammed paper", a: "pull it out gently" },
        { q: "there is a strange noise", a: "turn off the shredder" }
    ];

    const capsuleColors = ['#ffadad', '#ffd6a5', '#fdffb6', '#caffbf', '#9bf6ff', '#a0c4ff', '#bdb2ff', '#ffc6ff'];
    const capContainer = document.getElementById('capsuleContainer');
    for (let i = 0; i < 12; i++) {
        const cap = document.createElement('div');
        cap.className = 'capsule';
        cap.style.backgroundColor = capsuleColors[i % 8];
        capContainer.appendChild(cap);
    }

    const sList = document.getElementById('studyList');
    QA.forEach(item => {
        const li = document.createElement('li');
        li.innerText = `If ${item.q}, ${item.a}.`;
        sList.appendChild(li);
    });

    let currentA = "";
    const knob = document.getElementById('knob');
    const outCap = document.getElementById('outCapsule');
    const recGacha = document.getElementById('recordBtnGacha');

    knob.onclick = () => {
        recGacha.style.display = "none";
        outCap.style.display = "none";
        knob.classList.add('spin');
        setTimeout(() => {
            knob.classList.remove('spin');
            outCap.style.background = capsuleColors[Math.floor(Math.random()*8)];
            outCap.style.display = "block";
            const task = QA[Math.floor(Math.random()*QA.length)];
            currentA = task.a;
            speak(`What should I do if ${task.q}?`);
            recGacha.style.display = "block";
        }, 600);
    };
</script>
</body>
</html>
