<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VE1A Troubleshooting</title>
    <style>
        :root { --primary: #e63946; --dark: #1d3557; --glass: rgba(255,255,255,0.7); }
        body { font-family: -apple-system, system-ui, sans-serif; background: #f1faee; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        
        /* æ¨™é¡Œå€åŸŸ */
        .header { background: var(--dark); color: white; width: 100%; padding: 10px 0; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .header h1 { font-size: 1.2rem; margin: 0; }
        .instruction { font-size: 0.8rem; margin: 5px 0 0; color: #a8dadc; }

        /* æ‰­è›‹æ©Ÿæœ¬é«” */
        .machine-wrap { position: relative; width: 200px; height: 280px; margin-top: 15px; }
        .gacha-body { 
            width: 100%; height: 100%; background: var(--primary); 
            border: 4px solid var(--dark); border-radius: 60px 60px 20px 20px;
            position: relative; z-index: 2;
        }
        .gacha-glass {
            width: 160px; height: 120px; background: var(--glass);
            border: 4px solid var(--dark); border-radius: 50px 50px 10px 10px;
            position: absolute; top: 15px; left: 16px; display: flex; flex-wrap: wrap; justify-content: center; align-content: center;
        }
        
        /* æ‰­è›‹è·Œè½å‹•ç•« */
        .falling-capsule {
            width: 35px; height: 35px; border-radius: 50%; border: 3px solid var(--dark);
            position: absolute; top: 140px; left: 80px; z-index: 1; opacity: 0;
        }
        @keyframes fall {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            20% { opacity: 1; }
            80% { transform: translateY(90px); opacity: 1; }
            100% { transform: translateY(90px) scale(1.1); opacity: 1; }
        }
        .animate-fall { animation: fall 0.6s forwards ease-in; }

        /* æ‰­è›‹æ£ */
        .knob {
            width: 50px; height: 50px; background: #eee; border: 4px solid var(--dark);
            border-radius: 50%; position: absolute; bottom: 70px; left: 71px;
            cursor: pointer; z-index: 3; transition: transform 0.4s;
        }
        .knob::after { content: ''; position: absolute; width: 30px; height: 8px; background: var(--dark); top: 17px; left: 6px; }
        .spin { transform: rotate(180deg); }

        /* å‡ºè›‹å£ */
        .exit { width: 70px; height: 45px; background: var(--dark); position: absolute; bottom: 12px; left: 61px; border-radius: 10px; }

        /* æŒ‰éˆ•åŠåé¥‹ */
        #feedback { height: 50px; margin: 10px; font-size: 0.95rem; font-weight: bold; text-align: center; color: var(--dark); padding: 0 15px; }
        #recordBtn {
            background: var(--dark); color: white; border: none; padding: 12px 30px;
            border-radius: 30px; font-size: 1rem; cursor: pointer; display: none;
            box-shadow: 0 4px #457b9d;
        }
        #recordBtn:active { transform: translateY(2px); box-shadow: none; }

        /* åº•éƒ¨æ¸…å–® */
        .study-area { background: white; width: 90%; border-radius: 12px; padding: 10px; margin-top: auto; margin-bottom: 10px; box-sizing: border-box; border: 1px solid #ddd; }
        .study-area summary { font-size: 0.85rem; font-weight: bold; color: #555; cursor: pointer; }
        .study-area ul { margin: 5px 0 0; padding-left: 20px; font-size: 0.75rem; }
    </style>
</head>
<body>

    <div class="header">
        <h1>VE1A Troubleshooting</h1>
        <p class="instruction">1. Twist Knob â” 2. Listen â” 3. Answer<br>1. æ‰­è›‹è½å•é¡Œ â” 2. æ’³åˆ¶ç­”è¿”ç›¸å°ç­”æ¡ˆ</p>
    </div>

    <div class="machine-wrap">
        <div class="falling-capsule" id="capsule"></div>
        <div class="gacha-body">
            <div class="gacha-glass">
                <div style="width:20px;height:20px;background:#f94144;border-radius:50%;margin:2px"></div>
                <div style="width:20px;height:20px;background:#f3722c;border-radius:50%;margin:2px"></div>
                <div style="width:20px;height:20px;background:#f9c74f;border-radius:50%;margin:2px"></div>
                <div style="width:20px;height:20px;background:#90be6d;border-radius:50%;margin:2px"></div>
                <div style="width:20px;height:20px;background:#43aa8b;border-radius:50%;margin:2px"></div>
            </div>
            <div class="knob" id="knob"></div>
            <div class="exit"></div>
        </div>
    </div>

    <div id="feedback">Click the knob to start! <br>æ’³ä¸­é–“å€‹æ£é–‹å§‹</div>

    <button id="recordBtn">ğŸ¤ Press & Speak (ç­”é¡Œç›®)</button>

    <details class="study-area">
        <summary>View Study List (æº«ç¿’æ¸…å–®)</summary>
        <ul id="studyList"></ul>
    </details>

<script>
    const QA = [
        { q: "the machine overheats", a: "let it cool down" },
        { q: "the machine stops working", a: "check the power supply" },
        { q: "there is a jammed paper", a: "pull it out gently" },
        { q: "there is a strange noise", a: "turn off the shredder" }
    ];

    const studyList = document.getElementById('studyList');
    QA.forEach(item => {
        const li = document.createElement('li');
        li.innerText = `If ${item.q}, ${item.a}.`;
        studyList.appendChild(li);
    });

    const knob = document.getElementById('knob');
    const capsule = document.getElementById('capsule');
    const recordBtn = document.getElementById('recordBtn');
    const feedback = document.getElementById('feedback');
    let currentA = "";

    function speak(text) {
        window.speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'en-US';
        utter.rate = 0.85;
        window.speechSynthesis.speak(utter);
    }

    knob.onclick = () => {
        // Reset
        recordBtn.style.display = "none";
        feedback.innerText = "Twisting... æ‰­ç·Š...";
        knob.classList.add('spin');
        capsule.classList.remove('animate-fall');
        void capsule.offsetWidth; // Trigger reflow

        setTimeout(() => {
            knob.classList.remove('spin');
            
            // Animation
            const colors = ['#f94144', '#f3722c', '#f9c74f', '#90be6d', '#4d908e', '#577590'];
            capsule.style.background = colors[Math.floor(Math.random()*colors.length)];
            capsule.classList.add('animate-fall');

            // Pick Question
            const task = QA[Math.floor(Math.random() * QA.length)];
            currentA = task.a;
            
            // Speak
            speak(`What should I do if ${task.q}?`);
            
            feedback.innerHTML = "Listen carefully...<br>è«‹å›ç­”å°æ‡‰æ“ä½œ";
            recordBtn.style.display = "block";
            recordBtn.disabled = false;
        }, 500);
    };

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';

        recordBtn.onclick = () => {
            recognition.start();
            recordBtn.innerText = "ğŸ‘‚ Listening... (è«‹è¬›å˜¢)";
            recordBtn.disabled = true;
        };

        recognition.onresult = (event) => {
            const userSpeech = event.results[0][0].transcript.toLowerCase();
            recordBtn.innerText = "ğŸ¤ Press & Speak (ç­”é¡Œç›®)";
            
            if (userSpeech.includes(currentA.toLowerCase())) {
                feedback.innerHTML = `<span style="color:green">âœ¨ Correct! å¾ˆæ£’!</span><br>You said: "${userSpeech}"`;
                speak("Correct! Well done.");
                recordBtn.style.display = "none";
            } else {
                feedback.innerHTML = `<span style="color:#d00">âŒ Try again!</span><br>You said: "${userSpeech}"`;
                recordBtn.disabled = false;
            }
        };

        recognition.onerror = () => {
            feedback.innerText = "Microphone error. Try again.";
            recordBtn.disabled = false;
            recordBtn.innerText = "ğŸ¤ Press & Speak (ç­”é¡Œç›®)";
        };
    } else {
        feedback.innerText = "Browser not supported. Please use Chrome/Safari.";
    }
</script>
</body>
</html>
