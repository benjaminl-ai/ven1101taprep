<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Safety Gashapon</title>
    <style>
        :root { --primary: #ff6b6b; --secondary: #4ecdc4; --gold: #ffd700; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; background-color: #f0f2f5; padding: 20px; }
        
        /* æ‰­è›‹æ©Ÿæ¨£å¼ */
        .machine-container { position: relative; width: 280px; height: 400px; background: var(--primary); margin: 0 auto 20px; border-radius: 40px 40px 20px 20px; border: 8px solid #333; overflow: hidden; }
        .glass { width: 100%; height: 60%; background: rgba(255,255,255,0.3); border-bottom: 8px solid #333; display: flex; align-items: center; justify-content: center; position: relative; }
        .capsules-area { font-size: 50px; }
        
        /* æ‰­è›‹åˆ¶ */
        .knob { width: 80px; height: 80px; background: var(--gold); border: 5px solid #333; border-radius: 50%; margin: 20px auto; cursor: pointer; transition: transform 0.5s; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .knob.spin { transform: rotate(360deg); }
        
        /* éŒ„éŸ³åˆ¶ */
        .btn-record { padding: 15px 30px; font-size: 18px; border-radius: 50px; border: none; background: var(--secondary); color: white; cursor: pointer; display: none; margin: 0 auto; box-shadow: 0 4px #2a9d8f; }
        .btn-record:active { transform: translateY(4px); box-shadow: none; }

        /* å¥å­æ¸…å–® */
        .reference-list { max-width: 500px; margin: 30px auto; text-align: left; background: white; padding: 20px; border-radius: 10px; border: 2px dashed #ccc; }
        
        #feedback { height: 60px; margin-top: 15px; font-weight: bold; font-size: 1.1em; }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 10% { transform: translate(-1px, -2px); } 100% { transform: translate(1px, -1px); } }
    </style>
</head>
<body>

<h1>ğŸ•¹ï¸ Office Safety Gashapon</h1>
<p>Listen carefully and give the right instruction!</p>

<div class="machine-container" id="machine">
    <div class="glass">
        <div class="capsules-area" id="capsuleDisplay">ğŸ”®ğŸ”®ğŸ”®</div>
    </div>
    <div class="knob" id="spinBtn">TWIST</div>
    <div style="color: white; font-weight: bold;">INSERT COIN</div>
</div>

<button id="recordBtn" class="btn-record">ğŸ¤ Speak Answer</button>
<div id="feedback"></div>

<div class="reference-list">
    <h3>ğŸ“– Study List (Look before you play!)</h3>
    <ul id="studyList"></ul>
</div>

<script>
    const QA_PAIRS = [
        { q: "the machine overheats", a: "let it cool down" },
        { q: "the machine stops working", a: "check the power supply" },
        { q: "there is jammed paper", a: "pull it out gently" },
        { q: "there is a strange noise", a: "turn off the shredder" }
    ];

    // åˆå§‹åŒ–æ¸…å–®
    const studyList = document.getElementById('studyList');
    QA_PAIRS.forEach(pair => {
        const li = document.createElement('li');
        li.innerHTML = `If <b>${pair.q}</b>, <u>${pair.a}</u>.`;
        studyList.appendChild(li);
    });

    let currentQA = null;
    const spinBtn = document.getElementById('spinBtn');
    const recordBtn = document.getElementById('recordBtn');
    const feedback = document.getElementById('feedback');
    const machine = document.getElementById('machine');

    function speak(text) {
        window.speechSynthesis.cancel(); // åœæ­¢ä¹‹å‰çš„è²éŸ³
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'en-US';
        msg.rate = 0.9; // ç¨å¾®æ…¢ä¸€é»é»ï¼Œæ–¹ä¾¿å­¸ç”Ÿè½
        window.speechSynthesis.speak(msg);
    }

    // æ‰­è›‹é‚è¼¯
    spinBtn.onclick = () => {
        spinBtn.classList.add('spin');
        machine.classList.add('shake');
        feedback.innerText = "Dispensing question...";
        recordBtn.style.display = 'none';

        setTimeout(() => {
            spinBtn.classList.remove('spin');
            machine.classList.remove('shake');
            
            const index = Math.floor(Math.random() * QA_PAIRS.length);
            currentQA = QA_PAIRS[index];
            
            speak(`What should I do if ${currentQA.q}?`);
            
            feedback.innerText = "ğŸ‘‚ Listening to the machine... (Listen to the question)";
            recordBtn.style.display = 'block';
        }, 1000);
    };

    // èªéŸ³è¾¨è­˜
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) {
        alert("Your browser does not support speech recognition. Please use Chrome.");
    } else {
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';

        recordBtn.onclick = () => {
            recognition.start();
            feedback.innerText = "ğŸ™ï¸ Recording... Speak now!";
        };

        recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript.toLowerCase().replace(/[.,/#!$%^&*;:{}=\-_`~()]/g,"");
            const targetAnswer = currentQA.a.toLowerCase();
            
            // ç°¡å–®æ¨¡ç³Šæ¯”å°
            if (transcript.includes(targetAnswer) || targetAnswer.includes(transcript)) {
                feedback.innerHTML = `<span style="color:green">âœ¨ Correct!</span><br>You said: "${transcript}"`;
                speak("Excellent! That is correct.");
            } else {
                feedback.innerHTML = `<span style="color:red">âŒ Try again!</span><br>You said: "${transcript}"<br><small>(Hint: ${currentQA.a})</small>`;
                speak("Not quite, try again.");
            }
        };
    }
</script>

</body>
</html>
